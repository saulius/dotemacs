#+TITLE: misc

* Misc

Random functions and helpers

** Stable package installer for req-package

I need this because req-package ignores contents of package-pinned-packages
and installs latest available version from Melpa. I'd like to use Melpa stable
most of the time for stability.

#+BEGIN_SRC emacs-lisp
(defmacro req-stable-package (name &rest args)
  "Requires stable package version from Melpa Stable"
  `(progn
    (add-to-list 'package-pinned-packages '(,name . "melpa-stable"))
    (req-package ,name ,@args)))
#+END_SRC

** Bury buffer helper function

#+BEGIN_SRC emacs-lisp
(defun bury-buffer-delete-window ()
  (interactive)
  (bury-buffer)
  (delete-window))
#+END_SRC

** Open ansi term with correct shell

#+BEGIN_SRC emacs-lisp
(defun open-ansi-term ()
  "Toggle an ansi-term buffer."
  (interactive)
  (when (not (get-buffer "*ansi-term*"))
      (save-window-excursion (ansi-term (getenv "SHELL"))))
  (if (equal (buffer-name) "*ansi-term*")
      (quit-window)
    (switch-to-buffer-other-window "*ansi-term*")))
#+END_SRC

** Rename buffer and file

Renames current buffer and file

#+BEGIN_SRC emacs-lisp
;; from http://tuxicity.se/emacs/elisp/2010/03/26/rename-file-and-buffer-in-emacs.html
(defun rename-this-buffer-and-file ()
  "Renames current buffer and file it is visiting."
  (interactive)
  (let ((name (buffer-name))
        (filename (buffer-file-name)))
    (if (not (and filename (file-exists-p filename)))
        (error "Buffer '%s' is not visiting a file!" name)
      (let ((new-name (read-file-name "New name: " filename)))
        (cond ((get-buffer new-name)
               (error "A buffer named '%s' already exists!" new-name))
              (t
               (rename-file filename new-name 1)
               (rename-buffer new-name)
               (set-visited-file-name new-name)
               (set-buffer-modified-p nil)
               (message "File '%s' successfully renamed to '%s'" name (file-name-nondirectory new-name))))))))
#+END_SRC

** Save without whitespace

Saves current buffer killing whitespace

#+BEGIN_SRC emacs-lisp
(defun save-buffer-no-whitespace ()
  "Writes buffer with trimmed whitespace"
  (interactive)
  (delete-trailing-whitespace)
  (save-buffer))
#+END_SRC

** Kills buffer or split

#+BEGIN_SRC emacs-lisp
(defun kill-this-buffer-and-window ()
  "kills buffer and window (split)"
  (interactive)
  (kill-this-buffer)
  (delete-window))

(defun font-zoom-reset-font-size ()
 (interactive)
 (progn
  (setq font-zoom-index default-font-zoom-index)
  (set-frame-font (nth font-zoom-index font-zoom-list))))
#+END_SRC
